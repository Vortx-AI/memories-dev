{% extends "!layout.html" %}

{%- block extrahead %}
  {{ super() }}
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Memory Codex Documentation - Earth-grounded AI memory systems">
  <link rel="stylesheet" href="{{ pathto('_static/css/custom.css', 1) }}" type="text/css" />
  
  <!-- Book JavaScript -->
  <script src="{{ pathto('_static/js/book.js', 1) }}"></script>
  <script src="{{ pathto('_static/js/mermaid-init.js', 1) }}"></script>
  
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Book Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
  
  <style>
    /* Essential styles */
    body { 
      visibility: hidden; 
      margin: 0;
      padding: 0;
    }
    .book-reader { 
      visibility: visible !important; 
    }

    /* Theme toggle button */
    .theme-toggle-container {
      margin-top: 10px;
    }
    
    .theme-toggle-button {
      background: transparent;
      border: 1px solid var(--border-color);
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--sidebar-text-color);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .theme-toggle-button:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    /* Mobile navigation */
    @media screen and (max-width: 768px) {
      .wy-nav-content-wrap {
        margin-left: 0;
      }
      .wy-nav-side {
        left: -300px;
        transition: left 0.3s ease;
      }
      .wy-nav-side.shift {
        left: 0;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
      }
    }
  </style>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.body.classList.add('book-reader');
      document.body.style.visibility = 'visible';
      
      // Add theme toggle button
      const themeToggle = document.createElement('div');
      themeToggle.className = 'theme-toggle-container';
      themeToggle.innerHTML = '<button class="theme-toggle-button" aria-label="Toggle dark mode"><i class="fas fa-moon"></i></button>';
      document.querySelector('.wy-side-nav-search').appendChild(themeToggle);
      
      // Theme toggle functionality
      const toggleButton = themeToggle.querySelector('.theme-toggle-button');
      toggleButton.addEventListener('click', function() {
        const isDark = document.documentElement.classList.toggle('dark-theme');
        toggleButton.querySelector('i').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
        
        // Save preference
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        
        // Dispatch event for other scripts
        document.dispatchEvent(new CustomEvent('themeToggled', { 
          detail: { 
            theme: isDark ? 'dark' : 'light' 
          }
        }));
      });
      
      // Check for saved preference
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.documentElement.classList.add('dark-theme');
        toggleButton.querySelector('i').className = 'fas fa-sun';
      }
      // Default is light theme, so we don't need to check for system preference
    });
  </script>
{% endblock %}

{% block content %}
<div class="wy-nav-content-wrap">
  <div class="wy-nav-content book-content">
    <!-- Reading progress -->
    <div class="reading-progress"></div>
    
    <div class="rst-content">
      <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
        <div itemprop="articleBody">
          <!-- Book content -->
          <div class="book-page">
            {% block document %}
              {{ super() }}
            {% endblock %}
          </div>
        </div>
      </div>
      
      <!-- Chapter navigation -->
      {% block navigation %}
      <div class="book-navigation">
        {%- if prev %}
          <a href="{{ prev.link|e }}" class="prev-chapter" title="{{ prev.title|striptags|e }}" accesskey="p">
            <span class="nav-text">{{ prev.title|striptags|e }}</span>
          </a>
        {%- endif %}
        {%- if next %}
          <a href="{{ next.link|e }}" class="next-chapter" title="{{ next.title|striptags|e }}" accesskey="n">
            <span class="nav-text">{{ next.title|striptags|e }}</span>
          </a>
        {%- endif %}
      </div>
      {% endblock %}
    </div>
  </div>
</div>
{% endblock %}

{% block footer %}
<div class="book-footer">
  <div class="book-copyright">
    <p>&copy; 2023-2025 Memory Codex. All rights reserved.</p>
  </div>
</div>
{% endblock %} 